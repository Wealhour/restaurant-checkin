<script type="module">
  // Import necessary Firebase components
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, onChildRemoved, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBtUnTFpQgtM8wpPEGrU8ZNVr4CpLKehHU",
    authDomain: "restaurant-cran.firebaseapp.com",
    projectId: "restaurant-cran",
    storageBucket: "restaurant-cran.firebasestorage.app",
    messagingSenderId: "637517186100",
    appId: "1:637517186100:web:25bcb0ea440dd281ec7661",
    measurementId: "G-8YP5YS536H",
    databaseURL: "https://restaurant-cran-default-rtdb.europe-west1.firebasedatabase.app"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const today = new Date().toISOString().split('T')[0]; // Today's date
  const dateElement = document.getElementById('date');
  dateElement.textContent = today;

  const nameInput = document.getElementById('nameInput');
  const nameList = document.getElementById('nameList');
  const submitButton = document.getElementById('submitButton');
  
  const listRef = ref(database, 'restaurant-checkin/' + today);

  // Function to add names to the list
  const addNameToList = (name, key) => {
    const li = document.createElement('li');
    li.dataset.key = key;
    li.textContent = name;

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Remove';
    removeBtn.className = 'remove-button';
    removeBtn.onclick = () => {
      const userConfirmed = confirm('Do you want to remove your name?');
      if (userConfirmed) {
        remove(ref(database, 'restaurant-checkin/' + today + '/' + key));
      }
    };

    li.appendChild(removeBtn);
    nameList.appendChild(li);
  };

  // Listen for new names being added
  onChildAdded(listRef, (snapshot) => {
    addNameToList(snapshot.val(), snapshot.key);
  });

  // Listen for names being removed
  onChildRemoved(listRef, (snapshot) => {
    const li = nameList.querySelector(`li[data-key='${snapshot.key}']`);
    if (li) li.remove();
  });

  // Submit a name
  const submitName = () => {
    const name = nameInput.value.trim();
    if (name) {
      push(listRef, name);
      nameInput.value = '';
    }
  };

  submitButton.addEventListener('click', submitName);
  nameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      submitName();
    }
  });

  // Clear list if the date changes
  const lastCheckedDate = localStorage.getItem('lastCheckedDate');
  if (lastCheckedDate !== today) {
    // Clear data for the previous day
    nameList.innerHTML = ''; // Clear current list display
    // Update the "last checked date"
    localStorage.setItem('lastCheckedDate', today);
  }
</script>
